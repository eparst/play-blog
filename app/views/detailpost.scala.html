@import model._
@import com.feth.play.module.pa.views.html._

@(post: Post, user: User) @main("Detail post") {

    Name from session(auth):
    @if(user != null) {
        <p>@user.getName</p>
    } else {
        <p>not logged</p>
    }

    <h3>@post.getHeader</h3>
    <p>@post.getBody</p>
    <hr/>

    <div id="commentsContainer">
        <h4>Comments:</h4>
        @for(comment <- post.getComments) {
            <p>@comment.getBody</p>
            <small>By a @comment.getName</small>
            <hr/>
        }
    </div>

    @currentAuth() { auth =>
        @if(auth != null) {
            <h3>Add a comment as @user.getName</h3>
            <form id = "commentForm">
                <textarea name="body" cols="60" rows="10"></textarea> <br>
                <input type="submit" value="Submit">
            </form>
        } else {
            <p>Чтобы оставить комментарии необходимо авторизироваться</p>
        }

    }

    @*********************
    * We need incapsulate js in assets. post id we should store
    * in html attribute(<div id = "postContainde", data = "#11:2">)?
    * and then use its attribute in extarnal js
    *********************@
    <script>
    $("#commentForm").submit(function () {
    jsRoutes.controllers.Application.addComment('@post.getRid().toString').ajax({
    success: function (data) {
    $("#commentsContainer").append("<p>" + data.body + "</p><small>By a" + data.name + "</small><hr/>");
    $('#commentForm').each(function () {
    this.reset();
    });
    },
    error: function () {
    alert("Error!")
    },
    data: $("#commentForm").serialize()
    })
    return false;
    }
    )
    </script>


}
